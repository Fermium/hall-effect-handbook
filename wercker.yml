box: fermiumlabs/latex-docker

build:
  steps:
    - script:
        name: Build
        code: 
          - make all_compress
    - script:
        name: Zip and transfer results
        code:
          - cd Exports
          - zip -r Hall_Handbook_html.zip Assets Hall_Handbook.html
          - zip -r Hall_Handbook.zip ../../*
          - curl --upload-file ./Hall_Handbook.zip https://transfer.sh/Hall_Handbook.zip 

deploy:
  steps:
    - script:
      name: "Install amazon s3 cli"
      code: |
        curl "https://s3.amazonaws.com/aws-cli/awscli-bundle.zip" -o "awscli-bundle.zip"
        unzip awscli-bundle.zip
        sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws
    - script:
        name: "Push application build to S3"
        code: |
          aws s3 cp --recursive Exports/ s3://handbooks-autobuild/$WERCKER_GIT_REPOSITORY/
