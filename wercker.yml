box: fermiumlabs/latex-docker

build:
  steps:
    - script:
      name: Install dependencies
      code: |
          apt-key del "E298 A3A8 25C0 D65D FD57 CBB6 5171 6619 E084 DAB9"
          apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
          apt-get update -yqq
          apt-get install -yqq libcurl4-openssl-dev libssh2-1-dev curl  libxml2-dev libssl-dev imagemagick
    - script:
      name: Install R packages
      code: |
          # Install packages often required by Fermium LABS srl
          apt-key del "E298 A3A8 25C0 D65D FD57 CBB6 5171 6619 E084 DAB9"
          apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9
          Rscript -e "if (!require('here')) install.packages('here',repos='https://cran.rstudio.com');"
          Rscript -e "if (!require('tidyverse')) install.packages('tidyverse',repos='https://cran.rstudio.com');"
          Rscript -e "if (!require('gridExtra')) install.packages('gridExtra',repos='https://cran.rstudio.com');"
          Rscript -e "if (!require('ggthemes')) install.packages('ggthemes',repos='https://cran.rstudio.com');"
          Rscript -e "if (!require('ggpubr')) install.packages('ggpubr',repos='https://cran.rstudio.com');" 
    - script:
      name: Build
      code: |
          make clean
          make zip

deploy:
  steps:
    - edgecaseadmin/install-aws-cli:
           key: $AWS_ACCESS_KEY_ID
           secret: $AWS_SECRET_ACCESS_KEY
    - script:
        name: "Push application build to S3"
        code: |
          aws s3 sync --delete Exports/ s3://handbooks-autobuild/$WERCKER_GIT_REPOSITORY/
